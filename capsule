"use client";
import React, { useEffect, useRef } from "react";
import { gsap } from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { Community } from "./ourServices/community";
import AnimatedBeamDemo from "./ourServices/AnimatedBeam";
import { Vision } from "./vision";
import { PhysologyInfo } from "./PhysologyInfo";
import OurServices from "./ourServices/Our-services";
import Journals from "./Journals";
import GetInTouch from "./GetInTouch";
import Testimonials2 from "./Testimonials2";

gsap.registerPlugin(ScrollTrigger);

const CapsuleOpn = () => {
    const sectionRef = useRef<HTMLDivElement | null>(null);
    const leftRef = useRef<HTMLDivElement | null>(null);
    const rightRef = useRef<HTMLDivElement | null>(null);
    const contentWrapRef = useRef<HTMLDivElement | null>(null);

    useEffect(() => {
        const section = sectionRef.current;
        const left = leftRef.current;
        const right = rightRef.current;
        const contentWrap = contentWrapRef.current;
        if (!section || !left || !right || !contentWrap) return;

        ScrollTrigger.getAll().forEach((st) => st.kill());

        // ðŸ‘‰ Main timeline controlling all phases
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: section,
                start: "top top",
                end: () => `+=${section.offsetHeight + contentWrap.offsetHeight}`, // scroll distance
                scrub: true,
                pin: true,
                anticipatePin: 1,
            },
        });

        // Step 1: Open capsule
        tl.to(left, { xPercent: -85, ease: "power2.inOut" }, 0)
            .to(right, { xPercent: 85, ease: "power2.inOut" }, 0);

        // Step 2: While capsule is open, scroll through content
        // We move the contentWrap upward (to simulate scrolling between)
        tl.to(contentWrap, {
            yPercent: -100,
            ease: "none",
            duration: 3,
        });

        // Step 3: Close capsule at end
        tl.to(left, { xPercent: 0, ease: "power2.inOut" })
            .to(right, { xPercent: 0, ease: "power2.inOut" }, "<");

        return () => ScrollTrigger.getAll().forEach((st) => st.kill());
    }, []);

    return (
        <>
            {/* Capsule section */}
            <section
                ref={sectionRef}
                className="relative h-screen w-full flex justify-center items-center overflow-hidden bg-white"
            >
                {/* Left half */}
                <div
                    ref={leftRef}
                    className="absolute left-0 top-0 w-1/2 h-full flex justify-end items-center bg-white z-20"
                >
                    {/* <img
                        src="/assets/capsule/cap1nobg.png"
                        alt="Left Capsule"
                        className="w-[130px] h-auto object-cover"
                    /> */}
                    <div className='w-32 h-20 border-4 border-black rounded-l-full bg-white'></div>

                </div>

                {/* Right half */}
                <div
                    ref={rightRef}
                    className="absolute right-0 top-0 w-1/2 h-full flex justify-start items-center bg-white z-20"
                >
                    {/* <img
                        src="/assets/capsule/cap2nobg.png"
                        alt="Right Capsule"
                        className="w-[130px] h-auto object-cover"
                    /> */}
                    <div className='w-32 h-20 bg-red-600 border-4 border-black rounded-r-full'></div>

                </div>

                {/* Content that scrolls between halves */}
                <div
                    ref={contentWrapRef}
                    className="absolute top-0 left-0 w-full h-[1000vh] flex flex-col text-white text-center"
                >
                    <div className="h-[120vh]  flex flex-col justify-center">

                    </div>

                    <div className="h-[100vh]  flex justify-center items-start bg-white  rounded-lg mx-auto w-[80vw]">
                        <Community />
                    </div>

                    <div className="h-[100vh] flex justify-center items-center rounded-2xl overflow-hidden mx-auto w-[80vw]">
                        <Vision />
                    </div>


                    <div className="h-[100vh] my-24 flex justify-center items-center rounded-2xl overflow-hidden mx-auto w-[80vw] bg-white  p-16">
                        <AnimatedBeamDemo />
                    </div>



                    <div className="h-[100vh] my-24 flex justify-center items-center rounded-2xl overflow-hidden mx-auto w-[80vw] ">

                        <PhysologyInfo />
                    </div>



                    <div className="h-[100vh] my-24 flex justify-center items-center rounded-2xl overflow-hidden mx-auto w-[80vw]  p-24">
                        <OurServices />
                    </div>

                    <div className="h-[100vh] my-24 flex justify-center items-center rounded-2xl overflow-hidden mx-auto w-[80vw] bg-pink-300 py-20">
                        <Journals />
                    </div>
                    <div className="h-[100vh] flex justify-center items-center rounded-2xl overflow-hidden mx-auto w-[80vw]">
                        <GetInTouch />
                    </div>
                    <div className="h-[160vh] flex justify-center items-start my-24 rounded-2xl overflow-hidden mx-auto min-w-[80vw] bg-white">
                        <Testimonials2 />
                    </div>

                </div>
            </section>

        </>
    );
};

export default CapsuleOpn;
